<div class="login-container">
  <div class="login-card">
    @if (isLoginMode) {
      <h1 class="title">Prijavite se na vaš račun</h1>
    }
    @else {
      <h1 class="title">Stvorite novi račun</h1>
    }

    <div class="flex justify-center items-center w-full mb-4">
      <p-selectbutton
        [options]="modeOptions"
        [(ngModel)]="selectedMode"
        (ngModelChange)="onModeChange()"
        optionLabel="label"
        optionValue="value"
        aria-labelledby="mode-selector" />
    </div>

    <!-- Login forma -->
    @if (isLoginMode && !showVerification) {
        <form [formGroup]="loginForm" class="form" >
          <div class="field">
            <label for="login-email">E-mail adresa</label>
            <input
            pInputText
            id="login-email"
            type="email"
            placeholder="Unesite vašu e-mail adresu"
            class="input-field"
            formControlName="email" />
          </div>
          
          @if (loginForm.get('email')?.invalid && loginForm.get('email')?.touched) {
            <small class="error">Unesite valjanu e-mail adresu</small>
          }
          
          <div class="field">
            <label for="login-password">Lozinka</label>
            <p-password formControlName="password" feedback="false" [toggleMask]="true" styleClass="password-input" placeholder="Unesite vašu lozinku" />
          </div>
        
          <button
            pButton
            type="submit"
            label="Prijavi se"
            class="submit-btn"
            [loading]="loading"
            [disabled]="loginForm.invalid"
            (click)="login()">
          </button>
        </form>
    }

    <!-- Register forma -->
    @if (!isLoginMode && !showVerification) {
        <form [formGroup]="registerForm" class="form" >
          <div class="field">
            <label for="register-username">Korisničko ime</label>
            <input
              pInputText
              id="register-username"
              type="text"
              placeholder="Unesite korisničko ime"
              class="input-field"
              formControlName="username" />
          </div>
    
          <div class="field">
            <label for="register-email">E-mail adresa</label>
            <input
              pInputText
              id="register-email"
              type="email"
              placeholder="Unesite vašu e-mail adresu"
              class="input-field"
              formControlName="email" />
          </div>
    
          <div class="field">
            <label for="register-password">Lozinka</label>
            <p-password formControlName="password" feedback="false" [toggleMask]="true" placeholder="Unesite vašu lozinku" styleClass="password-input" />
          </div>
    
          <div class="field">
            <label for="confirm-password">Potvrdite lozinku</label>
            <p-password
              id="confirm-password"
              placeholder="Potvrdite vašu lozinku"
              [toggleMask]="true"
              [feedback]="false"
              styleClass="password-input"
              formControlName="confirmPassword">
            </p-password>
          </div>
    
          <button
            pButton
            type="submit"
            label="Registriraj se"
            class="submit-btn"
            [loading]="loading"
            [disabled]="registerForm.invalid"
            (click)="register()">
          </button>
        </form>
    }

    <p-dialog 
      header="Verifikacija e-maila" 
      [(visible)]="showVerification" 
      [modal]="true"
      [closable]="true"
      [style]="{ width: '400px' }">
      
      <p class="mb-4">Poslali smo verifikacijski kod na {{ verificationEmail }}</p>
      
      <div class="field">
        <label for="verification-code">Verifikacijski kod</label>
        <input
          pInputText
          id="verification-code"
          type="text"
          placeholder="Unesite 6-cifreni kod"
          class="input-field"
          [(ngModel)]="verificationCode"
          maxlength="6" />
      </div>

      <button
        pButton
        type="button"
        label="Potvrdi"
        class="submit-btn"
        [disabled]="verificationCode.length !== 6"
        (click)="verify()">
      </button>

      <div class="text-center mt-3">
        <p class="resend-text">
          Niste primili kod?
          <a (click)="resendCode()" class="resend-link cursor-pointer">Pošalji ponovo</a>
        </p>
      </div>
    </p-dialog>
  </div>
</div>
