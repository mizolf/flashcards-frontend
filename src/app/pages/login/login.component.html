<div class="login-container">
  <div class="login-card">
    @if (isLoginMode) {
      <h1 class="title">Sign in to your account</h1>
    }
    @else {
      <h1 class="title">Create a new account</h1>
    }

    <div class="flex justify-center items-center w-full mb-4">
      <p-selectbutton
        [options]="modeOptions"
        [(ngModel)]="selectedMode"
        (ngModelChange)="onModeChange()"
        optionLabel="label"
        optionValue="value"
        aria-labelledby="mode-selector" />
    </div>

    <!-- Login form -->
    @if (isLoginMode && !showVerification) {
        <form [formGroup]="loginForm" class="form" >
          <div class="field">
            <label for="login-email">Email address</label>
            <input
            pInputText
            id="login-email"
            type="email"
            placeholder="Enter your email address"
            class="input-field"
            formControlName="email" />
          </div>

          @if (loginForm.get('email')?.invalid && loginForm.get('email')?.touched) {
            <small class="error">Please enter a valid email address</small>
          }

          <div class="field">
            <label for="login-password">Password</label>
            <p-password formControlName="password" feedback="false" [toggleMask]="true" styleClass="password-input" placeholder="Enter your password" />
          </div>

          <button
            pButton
            type="submit"
            label="Sign in"
            class="submit-btn"
            [loading]="loading"
            [disabled]="loginForm.invalid"
            (click)="login()">
          </button>
        </form>
    }

    <!-- Register form -->
    @if (!isLoginMode && !showVerification) {
        <form [formGroup]="registerForm" class="form" >
          <div class="field">
            <label for="register-username">Username</label>
            <input
              pInputText
              id="register-username"
              type="text"
              placeholder="Enter your username"
              class="input-field"
              formControlName="username" />
          </div>

          <div class="field">
            <label for="register-email">Email address</label>
            <input
              pInputText
              id="register-email"
              type="email"
              placeholder="Enter your email address"
              class="input-field"
              formControlName="email" />
          </div>

          <div class="field">
            <label for="register-password">Password</label>
            <p-password formControlName="password" feedback="false" [toggleMask]="true" placeholder="Enter your password" styleClass="password-input" />
          </div>

          <div class="field">
            <label for="confirm-password">Confirm password</label>
            <p-password
              id="confirm-password"
              placeholder="Confirm your password"
              [toggleMask]="true"
              [feedback]="false"
              styleClass="password-input"
              formControlName="confirmPassword">
            </p-password>
          </div>

          <button
            pButton
            type="submit"
            label="Register"
            class="submit-btn"
            [loading]="loading"
            [disabled]="registerForm.invalid"
            (click)="register()">
          </button>
        </form>
    }

    <p-dialog
      header="Email verification"
      [(visible)]="showVerification"
      [modal]="true"
      [closable]="true"
      [style]="{ width: '90vw', maxWidth: '400px' }">

      <p class="mb-4">We sent a verification code to {{ verificationEmail }}</p>

      <div class="field">
        <label for="verification-code">Verification code</label>
        <input
          pInputText
          id="verification-code"
          type="text"
          placeholder="Enter 6-digit code"
          class="input-field"
          [(ngModel)]="verificationCode"
          maxlength="6" />
      </div>

      <button
        pButton
        type="button"
        label="Verify"
        class="submit-btn"
        [disabled]="verificationCode.length !== 6"
        (click)="verify()">
      </button>

      <div class="text-center mt-3">
        <p class="resend-text">
          Didn't receive the code?
          <a (click)="resendCode()" class="resend-link cursor-pointer">Resend</a>
        </p>
      </div>
    </p-dialog>
  </div>
</div>
